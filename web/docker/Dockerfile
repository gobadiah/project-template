FROM node:9.4.0

WORKDIR /usr/src/app

COPY package.json yarn.lock ./

ENV NODE_ENV production

RUN yarn install

COPY . .

ARG SENTRY_DSN
ENV SENTRY_DSN=$SENTRY_DSN

ARG SENTRY_PUBLIC_DSN
ENV SENTRY_PUBLIC_DSN=$SENTRY_PUBLIC_DSN

ARG WEB_URL
ENV WEB_URL=$WEB_URL

ARG BUCKET
ENV BUCKET=$BUCKET

ARG AWS_ACCESS_KEY_ID
ENV AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID

ARG GOOGLE_API_KEY
ENV GOOGLE_API_KEY=$GOOGLE_API_KEY

ARG GOOGLE_UNRESTRICTED_API_KEY
ENV GOOGLE_UNRESTRICTED_API_KEY=$GOOGLE_UNRESTRICTED_API_KEY

RUN npm run build

EXPOSE 3000

CMD npm run start
